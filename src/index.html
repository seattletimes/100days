<%
var moment = require("moment");

%><!doctype html>
<html>
  <head>
    <%= t.include("partials/_head.html") %>
    <link rel="stylesheet" type="text/css" href="style.css"> 
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  </head>
  <body>

    <%= t.include("partials/_nav.html") %>


    <section class="title">
      <h1 class="headline">Trump's first 100 days</h1>
    </section>

    <main class="content">

    <section class="introduction">
      <p class="intro">
        President Donald Trump has hit his 100th day in office. We've tracked the statuses of his promises, outlined in his <a href="https://assets.donaldjtrump.com/CONTRACT_FOR_THE_VOTER.pdf">"Contract with the American Voter,"</a> and may affect the Pacific Northwest, especially Washington.

        <!-- As of today, President Donald Trump has been in office for <b><span class="currentDay"></span> days</b>. We're tracking the statuses of promises outlined in his <a href="https://assets.donaldjtrump.com/CONTRACT_FOR_THE_VOTER.pdf">"Contract with the American Voter,"</a> which contains his plan for his first 100 days in office. He has <b><span class="days-remaining"></span> days</b> remaining in this period. --></p>
    </section>

    <section class="progress-bar">

      <%
        var progressByStatus = {};
        var statusCount = 0;
        json.goals.forEach(function(g) {
        var stat = g.promise_status;
        if (!stat) return;
        if (!progressByStatus[stat]) progressByStatus[stat] = 0;
        if (stat) {
          progressByStatus[stat]++;
          if (stat !== "none") statusCount++;
          }
        });
      %>

      <div class="bar-label">Status of Trump's promises</div>
      <div class="bar-container">
        <div class="completed" style="width: <%= (statusCount / json.goals.length * 100).toFixed(2) %>%">
          <% for (var s in progressByStatus) { 
            if (s !== "none") {%>
              <div
                style="width: <%= (progressByStatus[s] / statusCount * 100).toFixed(2) %>%"
                class="bar <%= s.toLowerCase() %>"
              ></div><% } 
            } %>
        </div>
      </div>

      <!-- legend -->
      <div class="legend">
        <ul class="legend-key">
          <% for (var s in progressByStatus) { %>
          <li class="status-legend <%= s.toLowerCase() %>">

          <div class="quantity"> <%= progressByStatus[s] %> </div>

            <div class="status-title">
              <% if (s == "none"){ %> 
                No action <% }
                else { %>
                <%= s %>
                <% } %>
              </div>

          </li>
          <% } %>
        </ul>
      </div>

    </section>

        <%
        var byDay = {};
        json.daily.forEach(function(row) {
          if (!byDay[row.day]) {
            byDay[row.day] = [];
          }
          byDay[row.day].push(row);
        });
        %>

      <div>
        <nav class="jump-to">
          <ul>
            <li><a href="#day-by-day">Jump to: <i class="fa fa-calendar" aria-hidden="true"></i> A day-by-day look at Trump's actions</a></li> 

            <li class="pipe"> | </li>

            <li><a href="http://www.seattletimes.com/nation-world/nation-politics/"><i class="fa fa-external-link" aria-hidden="true"></i> Read all our politics coverage</a></li>
          </ul>
        </nav>
      </div>

      <section class="dates-goals">

        <div class="checklist narrow" id="action-plan">
          <h2>100-day action plan</h2>

          <nav class="checklist-key">
            <input type="checkbox" class="plan-filter" id="completed">
            <label for="completed">
              <span class="text event complete"><i class="icon"></i> Promise kept</span>
            </label> 

            <input type="checkbox" class="plan-filter" id="broken">
            <label for="broken" class="broken">
              <span class="text event broken"><i class="icon"></i> Promise broken</span>
            </label>

            <input type="checkbox" class="plan-filter" id="developing">
            <label for="developing">
              <span class="text event developing"><i class="icon"></i> Developing</span>
            </label>             
            
            <input type="checkbox" class="plan-filter" id="incomplete">
            <label for="incomplete" class="incomplete">
              <span class="text event incomplete"><i class="icon"></i> Incomplete</span>
            </label>


            <!-- dropdown menu for categories -->

            <!-- creates an array with categories -->
            <% 
              var categories = [];

              function isInArray(categories, cat_title) {
                return categories.indexOf(cat_title) > -1;
              }

              json.goals.forEach(function(k) { 
                var cat_title = k.category;
                if (!isInArray(categories, cat_title)) {
                  categories.push(cat_title);
                }
              }) %>


            <select class="topics">
              <option value="">Filter by category</option>

              <% for (var i=0; i < categories.length; i++) { %>
                <option value=<%= categories[i] %>>
                  <%= categories[i] %>
                </option>
              <% } %>

            </select>
            <!-- end of menu -->

          </nav>

          <ol>
            <%
            var lookup = {}
            var itemsByCat = {}
            json.goals.forEach(function(g) {
              if (!itemsByCat[g.category]) itemsByCat[g.category] = [];
              itemsByCat[g.category].push(g);
              g.progress = "";
              if (g.day_completed) {
                g.progress = "completed";
              } else {
                if (g.developing) {
                  g.progress = "developing";
                } else {
                  if (g.day_broken) {
                    g.progress = "broken";
                  } else {
                      g.progress = "incomplete";
                  }
                }
              }
            });

            Object.keys(itemsByCat).forEach(function(c) { %>
              <header class="label-container" data-topic="<%=c.toLowerCase()%>">
                  <div class="category-label <%= c.toLowerCase() %>"><%= c %></div>
                </header>

              <% itemsByCat[c].forEach(function(k) {
                
                %>
                <li class="plan-item" data-progress="<%= k.progress %>" data-topic="<%= k.category %>">
                <% if (k.day_completed) { lookup[k.day_completed] = true; %>
                  <span class="text event complete"><i class="icon"></i></span>
                <% } else if (k.developing) { lookup[k.developing] = true; %>
                  <span class="text event developing"><i class="icon"></i></span>
                  <% } else if (k.day_broken) { lookup[k.day_broken] = true; %>
                  <span class="text event broken"><i class="icon"></i></span>

                <% } else { %>
                  <span class="text event incomplete"><i class="icon"></i></span>
                <% } %>

                <%= k.goal %> 

                <ul>
                  <% if (k.summary) { %>
                    <li class="update">
                      Update <i class="fa fa-clock-o" aria-hidden="true"></i>:
                      <div><%= k.summary %> <a href="<%=k.url%>"><%=k.link%></a></div>
                    </li>
                  <% } %>

                </ul>


            <% }) %>


          </li>



            <% }) %>
          </ol>

    </section>

    <div class="to-top"><a href="#action-plan">&uarr; Top</a></div>
    <hr>

    </main>


    <script>
    window.goals = <%= JSON.stringify(json.goals) %>;
    window.daily = <%= JSON.stringify(json.daily) %>;
    </script>

    <script src="app.js" async></script>
    <% if (json.project.production) { %>
    <%= !json.project.embedded ? t.include("partials/_foot.html") : "" %>
    <%= t.include("partials/_workHere.html") %>
    <% } %>
  </body>
</html>
